on:
  workflow_dispatch: 

jobs:
  test-lark:
    name: test lark noti
    runs-on: ubuntu-latest

    steps:
      - name: Get current Job ID
        id: get_job_id
        run: |
          response=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/runs/${{ github.run_id }}/jobs)

          job_id=$(echo "$response" | jq ".jobs[] | select(.name == \"${{ github.job }}\") | .id")
          echo "Job ID: $job_id"
          
          # Export to env for future steps
          echo "GITHUB_JOB_ID=$job_id" >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}      
      - name: Hello world action step
        id: hello
        uses: phuoc-le/action-lark-notify@feature/add-extra-columns
        with: 
            columnsPerRow: 2
            cardItems: |
                **Repo**\n[{{GITHUB_REPOSITORY}}]({{GITHUB_SERVER_URL}}/{{GITHUB_REPOSITORY}})
                **Event**\n{{GITHUB_EVENT_NAME}}
                **Actor**\n{{GITHUB_ACTOR}} 
                **Ref**\n[{{GITHUB_REF}}]({{GITHUB_SERVER_URL}}/{{GITHUB_REPOSITORY}}/tree/{{GITHUB_REF_NAME}})
                **Job**\n[{{GITHUB_JOB_ID}}]({{GITHUB_SERVER_URL}}/{{GITHUB_REPOSITORY}}/actions/runs/{{GITHUB_RUN_ID}}/job/{{GITHUB_JOB_ID}})
                **Release**\n[{{RELEASE_TAG}}]({{GITHUB_SERVER_URL}}/{{GITHUB_REPOSITORY}}/releases/tag/{{RELEASE_TAG}})
        env:
          LARK_WEBHOOK: ${{ secrets.LARK_WEBHOOK }}
          LARK_MESSAGE_TITLE: "test"
          LARK_MESSAGE_SUBTITLE: |
            Status: test 
          RELEASE_TAG: v1.0.0
          GITHUB_JOB_ID: ${{ env.GITHUB_JOB_ID }}


